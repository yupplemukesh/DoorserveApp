
@{
	ViewBag.Title = "Index";
}
<div class="row">
	<div class="col-md-12 col-sm-12 col-xs-12">
		<div class="x_panel">
			<div class="x_title">
                <h3 class="m-y-0">Pending Entry Level Screening</h3>
                    <ul class="nav navbar-right panel_toolbox">
                        <li>
                            <a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                        </li>

                    </ul>
                    <div class="clearfix"></div>
</div>
			<div class="x_content">
                <div id="hiddenPart" style="display:none">
                    @*@Html.Partial("FindPFELS")*@
                    @Html.Action("PFELSForm", "Trc_PFELS")
                </div>
				
				<div class="x_content" style="overflow-x: scroll;">
					@Html.Action("TablePFELS", "Trc_PFELS")
				</div>
			</div>
		</div>
	</div>
</div>
@if (ViewBag.Message != null)
{
	<div id="snackbar">@ViewBag.Message</div>
}
@if (ViewBag.Message != null)
{
	<script>

        var x = document.getElementById("snackbar");
        x.className = "show";
        setTimeout(function () { x.className = x.className.replace("show", ""); }, 3000);

	</script>
}

<div id="snackbar">Please search By Call Request Number First</div>
@section Scripts{

	<script>
        $('#myTable input:button').click(function () {
            //alert($(this).val());
            var ccNo = $(this).val()
            CCno(ccNo);
            $('#hiddenPart').show();
        });
		function AjaxWithValue(method, ddl, e) {
			var val = e.value;

			$.ajax({
				type: "GET",
				url: "/DropdownBind/" + method + "?value=" + val,
				data: '{}',
				contentType: "application/json; charset=utf-8",
				dataType: "json",
				success: function (data) {
					$("#" + ddl).empty();

					//var sel = new Option('-Select-', '');
					//$('#' + ddl).append(sel);
					for (var i = 0; i < data.length; i++) {
						var opt = new Option(data[i].Text, data[i].Value);
						$('#' + ddl).append(opt);
					}
				}
			});
		}
		//Remove Button
		//$("#test1").on('click', '.btnDelete', function () {
		//	var currentRow = $(this).closest("tr");
		//	var col1 = currentRow.find("td:eq(0)").text(); // get current row 1st TD value
			
		//	var col4 = currentRow.find("td:eq(3)").text(); // get current row 4th TD
	
		//	$.ajax({
		//		type: 'POST',
		//		url: "/RepairStatus/RowStatusUpdated?CC_NO=" + col1 + "&SpareCode=" + col4,
		//		contentType: 'application/json; charset=utf-8',
		//		cache: false,
		//		success: function (response) {
		//			debugger;
		//			if (response == 1) {
		//				currentRow.remove();
		//			}
		//			else {
		//				alert("Not removed")
		//			}
		//		},
		//		error: function (e) {
		//			console.log(e);
		//			$(".submitbutton").attr("disabled", false);
		//			alert("Something went wrong...");

		//		},
		//		complete: function () {

		//			$(".submitbutton").attr("disabled", false);
		//		}

		//	});
			
		//});
        $("#test1").on('click', '.btnDelete', function () {
            $(this).closest('tr').remove();
        });
		// Search button cc_no

		function CCno(ccNo) {
            $(window).scrollTop(0);
			$.ajax({
				type: 'POST',
                url: "/Trc_PFELS/FindPFELS?CcNO=" + ccNo,
				contentType: 'application/json; charset=utf-8',
				cache: false,
                success: function (response) {
                    var rowCount = test1.rows.length;
                    for (var i = rowCount - 1; i > 0; i--) {
                        test1.deleteRow(i);
                    }

					var Quan = 1;
					var trHTML = '';
					$.each(response.TableData1, function (i, item) {
						trHTML +=
						 	'<tr style="padding-top:5px"><td>' + item.TablespaceCC_NOField1 + '</td><td>' + item.TablespaceJobNumberField1 + '</td><td>' + item.TablespareTypeField1 + '</td><td>' + item.TablespareCodeField1 + '</td><td><img src="" id="foo" alt="" width=100 height=100></td><td id="PartName">' + item.TablespareNameField1 + '</td><td>' + item.TablespareQuantityField1 + '</td><td>' + "<input class=btnDelete type=button value=Remove style=background-color:red;color:white>" + '</td></tr>';
					});
					$('#test1').append(trHTML);
					
					var DamagedBoxImage = 'http://crm.togofogo.com/Uploaded Images/' + response.DamagedBoxImage;
					var url = 'http://crm.togofogo.com/Uploaded Images/' + response.PhotoOfDevice;
					$('#TRCInfoFull').val("Trc Name:" + response.TrcName + ",Mobile No:" + response.TrcMobile + " , Email:" + response.TrcEmail, " , Address:" + response.TrcAddress +
						", Pincode:" + response.TrcPinCode + " ,Location:" + response.TrcLocality + ", Near By Location :" + response.TrcNear_By_Location);
					$('#CustoFullInfo').val("Name:" + response.Customer_Name + ", Mobile No.:" + response.Mobile_No + ", E-Mail: " + response.Email_Id + ", Customer Address:" + response.Cust_Add +
						", Pincode" + response.Pincode + " City/Location:" + response.Cust_City + " , State:" + response.Cust_State);
					$('#ProcessName').val(response.TrcProcess_Name);
					$('#TRCCity').val(response.TRCCity);
					$('#TrcName').val(response.TrcName)
					$('#WarrentyStatus').val(response.WarrantyStatus);
					//$('#WarrentyExpiryDate').val(response.WarrantyExpiryDate.split(' ')[0]);
					$('#EstimatedCost').val(response.EstimatedCost);
					$('#WarrantyVoid').val(response.WarrantyVoid);
					$('#wipedevice').val(response.wipedevice);
					$('#CostApproved').val(response.EstimatedCostApproved);
					$('#CourierName').val(response.CourierName);
					$('#ProblemObserved').val(response.PrblmObsrvd);
					$('#ProblemReported').val(response.Problem)
					$('#CC_NO').val(response.CcNo);
					$('#Mobile_No').val(response.Mobile_No);
					$('#Brand').val(response.Brand);
					$('#ServiceProviderName').val(response.ServiceProviderName);
					$('#Cust_Add').val(response.Cust_Add);
					$('#Cust_City').val(response.Cust_City);
					$('#Cust_State').val(response.Cust_State);
					$('#CustomerId').val(response.CustomerId);

					$('#Customer_Name').val(response.Customer_Name);
					$('#Email_Id').val(response.Email_Id);
					$('#Model').val(response.Model);
					$('#Pickup_Date').val(response.Pickup_Date);
					$('#Pincode').val(response.Pincode);
					$('#Problem').val(response.Problem);
					$('#StatusName').val(response.StatusName);
					$('#SubCatName').val(response.SubCatName);
					$('#Serial_No').val(response.Serial_No);
					$('#IMEI1').val(response.IMEI1);
					$('#IMEI2').val(response.IMEI2);
					$('#BtryRemovable').val(response.BtryRemovable);
					$('#BtryReq').val(response.BtryReq);
					$('#IsDiffDeviceRecvd').val(response.IsDiffDeviceRecvd);
					$('#IsDiffDeviceRecvd').val(response.IsDiffDeviceRecvd);
					$('#RecvdBrand').val(response.RecvdBrand);
					$('#RecvdModel').val(response.RecvdModel);
					$('#IsPhyDamage').val(response.IsPhyDamage);
					$('#ReceiveDate').val(response.ReceiveDate);
					$('#RecvRemarks').val(response.RecvRemarks);
					$('#EnggName').val(response.EnggName);
					$('#BtryReceived').val(response.BtryReceived);
					$('#BtryBrandAndModel').val(response.BtryBrandAndModel);
					$('#DeviceTUPC').val(response.DeviceTUPC);
					$('#RecvdSerialNo').val(response.RecvdSerialNo);
					$('#RecvdIMEI1').val(response.RecvdIMEI1);
					$('#RecvdIMEI2').val(response.RecvdIMEI2);
					$('#ReceiveApprovalNeeded').val(response.ReceiveApprovalNeeded);
					$('#RecvApprovalStatus').val(response.RecvApprovalStatus);
					$('#RecvApprovedBy').val(response.RecvApprovedBy);
					$('#PhotoOfDevice').attr('src', url);
					$('#DamagedBoxImage').attr('src', DamagedBoxImage);
					$('#ReceivedDevice').val(response.RecvdDevice);

					$('#ApproverRemarks').val(response.ApproverRemarks);
					$('#IsApproveforReceivingDevice').val(response.IsApproveforReceivingDevice);
					$('#JobNumber').val(response.JobNumber);
                    $('#CurrentStatus').val(response.CurrentStatus);
                    $('#CallStatus').val(response.CallStatus);
					$('#BoxCondition').val(response.BoxCondition);
					$('#ReceivingDoc').val(response.ReceivingDocument);
					$('#Returnable').val(response.IsReturnable);
					$('#NoOfBoxesReceived').val(response.NoOfBoxesReceived);
                    $('#AWBNo').val(response.AWBNumber);
                    $('#CallRequestDate').val(response.EntryDate);
                    $('#ScheduleDate').val(response.SchedulePickupDateandTime);
				},
				error: function (e) {
					console.log(e);
					$(".submitbutton").attr("disabled", false);
					alert("Something went wrong...");

				},
				complete: function () {

					$(".submitbutton").attr("disabled", false);
				}
			});
		}

		function checkSubmit() {		
			var listName = "TableData";
			var table = $("#test1 tbody");
			var qtd = 0;
			table.find('tr').each(function (i) {
				var $tds = $(this).find('td');
				//console.log($tds);

				$("#form11").prepend("<input type='hidden'name='" + listName + "[" + qtd + "].TablespaceCC_NOField' value='" + document.getElementById('CC_NO').value + "'>");
				$("#form11").prepend("<input type='hidden'name='" + listName + "[" + qtd + "].TablespaceJobNumberField' value='" + document.getElementById('JobNumber').value + "'>");
				$("#form11").prepend("<input type='hidden'name='" + listName + "[" + qtd + "].TablespareTypeField' value='" + $tds.eq(2).text() + "'>");
				$("#form11").prepend("<input type='hidden'name='" + listName + "[" + qtd + "].TablespareCodeField' value='" + $tds.eq(3).text() + "'>");
				$("#form11").prepend("<input type='hidden'name='" + listName + "[" + qtd + "].TablesparePartPhoto' value='" + $tds.eq(4).text() + "'>");
				$("#form11").prepend("<input type='hidden'name='" + listName + "[" + qtd + "].TablespareNameField' value='" + $tds.eq(5).text() + "'>");
				$("#form11").prepend("<input type='hidden'name='" + listName + "[" + qtd + "].TablespareQuantityField' value='" + $tds.eq(6).text() + "'>");

				qtd += 1;
			});
			return true;
		}

		// ADD button
		function getSpareData() {			
			var e = $('#getCC_NO').val();
			if ($("#getCC_NO").val() == "") {
				debugger;
				var x = document.getElementById("snackbar");
				x.className = "show";
				setTimeout(function () { x.className = x.className.replace("show", ""); }, 4000);
			}

			var selectedCountry = $("#SpareType option:selected").val();
			if (selectedCountry != null)
			{
				var table = document.getElementById('test1');
				var rowLength = table.rows.length;
				var cell = "";
				var showMsg = "";
				for (var i = 1; i < rowLength; i += 1) {
					var row = table.rows[i];
					var cellLength = row.cells.length;					
						cell = row.cells[3];
						showMsg = row.cells[0].innerHTML;
					//do something with every cell here		
						if (cell.innerHTML == selectedCountry) {

							alert("You're trying to add " + showMsg + " Again please select other");
							break;
						}
						
				}
				if (cell.innerHTML != selectedCountry) {
					var spareType = $("#SpareType").val();
					var spareName = $("#SpareName").val();
					var Quantity = $("#Quantity").val();

					$.ajax({
						type: 'GET',
						url: "/RepairStatus/SpareName?spareType=" + spareType + "&spareName=" + spareName,
						contentType: 'application/json; charset=utf-8',
						cache: false,
						success: function (response) {
							var Quan = 1;
							var trHTML = '';

							trHTML += '<tr style="padding-top:5px"><td>' + document.getElementById('CC_NO').value + '</td><td>' + document.getElementById('JobNumber').value + '</td><td>' + response.SpareTypeName + '</td><td>' + response.SpareCode + '</td><td><img src="' + response.Part_Image + '" id="foo" alt="" width=100 height=100></td><td id="PartName">' + response.PartName + '</td><td>' + document.getElementById('Quantity').value + '</td><td>' + "<input class=btnDelete type=button value=Remove style=background-color:red;color:white>" + '</td></tr>';

							$('#test1').append(trHTML);
						},
						error: function (e) {
							console.log(e);
							$(".submitbutton").attr("disabled", false);
							alert("Something went wrong...");

						},
						complete: function () {

							$(".submitbutton").attr("disabled", false);
						}

					});
				}
				
			}							
			


		}
		function calculateBill() {
			var cost = 0;
			var totalCost = 0;
			var table = document.getElementById('test1');
			var rows = $('#test1 tbody tr').length;
			for (var i = 1; i <= rows; i += 1) {
				var row = table.rows[i];
				console.log(row);
				var se = row.cells[4].innerHTML;
				var cost = row.cells[4].innerHTML * row.cells[5].innerHTML;
				totalCost = totalCost + cost;
			}
			var service = document.getElementById('BillServiceCharge').value = 100;
			var estiCost = service + totalCost;
			$('#BillSpareCost').val(totalCost);
			$('#BillEstimatedCost').val(estiCost);
		}
	</script>
}