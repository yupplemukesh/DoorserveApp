@*@model TogoFogo.Models.UserActionRights*@
@using TogoFogo.Models

@{
    ViewBag.Title = "RCE";
}

<div class="row">
    <div class="col-md-12 col-sm-12 col-xs-12">
        <div class="x_panel">
            <div class="x_title">
                <h2><small></small></h2>
                <ul class="nav navbar-right panel_toolbox">
                    <li>
                        <a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                    </li>

                </ul>
                <div class="clearfix"></div>
            </div>
            <div class="x_content">
                <br />
                @*@Html.Partial("FindRCE")*@
                <div id="hiddenPart" style="display:none">
                    @if (Permissions.Rights.Create)
                    {
                        @Html.Partial("FindRCE", new TogoFogo.Models.RmFormModel())
                        @Html.Action("RCEForm", "PurchaseProcurement")
                    }
                </div>

                <div class="x_content" style="overflow-x: scroll;">
                    @if (Permissions.Rights.View)
                    {
                        @Html.Action("TableRCE", "PurchaseProcurement")
                    }
                </div>
            </div>
        </div>
    </div>
</div>
@if (ViewBag.Message != null)
{
    <div id="snackbar">@ViewBag.Message</div>
}
@if (ViewBag.Message != null)
{
    <script>

        var x = document.getElementById("snackbar");
        x.className = "show";
        setTimeout(function () { x.className = x.className.replace("show", ""); }, 3000);

    </script>
}
@section Scripts{

    <script>
        $('#myTable input:button').click(function () {
            //alert($(this).val());
            var ccNo = $(this).val()
            CCno(ccNo);
            $('#hiddenPart').show();
        });
        function AjaxWithValue(method, ddl, e) {
            var val = e.value;

            $.ajax({
                type: "GET",
                url: "/DropdownBind/" + method + "?value=" + val,
                data: '{}',
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data) {
                    $("#" + ddl).empty();

                    //var sel = new Option('-Select-', '');
                    //$('#' + ddl).append(sel);
                    for (var i = 0; i < data.length; i++) {
                        var opt = new Option(data[i].Text, data[i].Value);
                        $('#' + ddl).append(opt);
                    }
                }
            });
        }
        // ADD button
        function getSpareData() {
            var e = $('#getCC_NO').val();
            if ($("#getCC_NO").val() == "") {
                var x = document.getElementById("snackbar");
                x.className = "show";
                setTimeout(function () { x.className = x.className.replace("show", ""); }, 4000);
            }

            var selectedCountry = $("#SpareType option:selected").val();
            if (selectedCountry != null) {
                var table = document.getElementById('test1');
                var rowLength = table.rows.length;
                var cell = "";
                var showMsg = "";
                for (var i = 1; i < rowLength; i += 1) {
                    var row = table.rows[i];
                    var cellLength = row.cells.length;
                    cell = row.cells[3];
                    showMsg = row.cells[2].innerHTML;
                    //do something with every cell here
                    if (cell.innerHTML == selectedCountry) {

                        alert("You're trying to add " + showMsg + " Again please select other");
                        break;
                    }

                }
                if (cell.innerHTML != selectedCountry) {
                    var spareType = $("#SpareType").val();
                    var spareName = $("#SpareName").val();
                    var Quantity = $("#Quantity").val();

                    $.ajax({
                        type: 'GET',
                        url: "/RepairStatus/SpareName?spareType=" + spareType + "&spareName=" + spareName,
                        contentType: 'application/json; charset=utf-8',
                        cache: false,
                        success: function (response) {
                            var Quan = 1;
                            var trHTML = '';
                            var total = response.MarketPrice * Quantity;
                            trHTML += '<tr id=newlyAddedValues style="padding-top:5px"><td>' + document.getElementById('CC_NO').value + '</td><td>' + document.getElementById('JobNumber').value + '</td><td>' + response.SpareTypeName + '</td><td>' + response.SpareCode + '</td><td><img src="' + response.Part_Image + '" id="foo" alt="" width=100 height=100></td><td id="PartName">' + response.PartName + '</td><td class="editableColumns" id="editableColumns">' + response.MarketPrice + '</td><td id="Quantity">' + document.getElementById('Quantity').value + '</td><td id="total">' + total + '</td><td>' + "<input class=editValues form-control type=button value=Edit style=margin-right:5px;;color:white;background-color:#31b0d5>" + "<input class=saveValues type=button value=Save style=background-color:green;color:white>" + '</td></tr>';

                            $('#test1').append(trHTML);

                        },
                        error: function (e) {
                            console.log(e);
                            $(".submitbutton").attr("disabled", false);
                            alert("Something went wrong...");

                        },
                        complete: function () {

                            $(".submitbutton").attr("disabled", false);
                        }

                    });
                }

            }



        }
        function checkSubmit() {
            var listName = "TableData";
            var table = $("#test1 tbody");
            var qtd = 0;
            table.find('tr').each(function (i) {
                var $tds = $(this).find('td');
                //console.log($tds);
                $("#form11").prepend("<input type='hidden'name='" + listName + "[" + qtd + "].TablespaceCC_NOField' value='" + document.getElementById('CC_NO').value + "'>");

                $("#form11").prepend("<input type='hidden'name='" + listName + "[" + qtd + "].TablespareTypeField' value='" + $tds.eq(2).text() + "'>");
                $("#form11").prepend("<input type='hidden'name='" + listName + "[" + qtd + "].TablespareCodeField' value='" + $tds.eq(3).text() + "'>");
                $("#form11").prepend("<input type='hidden'name='" + listName + "[" + qtd + "].TablesparePartPhoto' value='" + $tds.eq(4).text() + "'>");
                $("#form11").prepend("<input type='hidden'name='" + listName + "[" + qtd + "].TablespareNameField' value='" + $tds.eq(5).text() + "'>");
                $("#form11").prepend("<input type='hidden'name='" + listName + "[" + qtd + "].TablesparePriceField' value='" + $tds.eq(6).text() + "'>");
                $("#form11").prepend("<input type='hidden'name='" + listName + "[" + qtd + "].TablespareQuantityField' value='" + $tds.eq(7).text() + "'>");
                $("#form11").prepend("<input type='hidden'name='" + listName + "[" + qtd + "].TablespareTotalField' value='" + $tds.eq(8).text() + "'>");

                qtd += 1;
            });
            return true;
        }
        $("#test1").on('click', '.editValues', function () {
            debugger;
            $(this).parents('tr').find('td.editableColumns').each(function () {
                var html = $(this).html();
                var input = $('<input class="editableColumnsStyle btn-warning form-control" type="text" id="getData" />');
                input.val(html);
                $(this).html(input);
            });
        });
        $("#test1").on('click', '.saveValues', function () {
            $(this).parents('tr').find('td.editableColumns').each(function () {
                var html = $(this).html();
                var x = document.getElementById("getData").value;
                var input = x;
                $(this).html(input);
                var price = $(this).closest('tr').find('td:eq(6)').text();
                var Quantity = $(this).closest('tr').find('td:eq(7)').text();
                tot = price * Quantity;
                $(this).closest('tr').find('td:eq(8)').text(tot);
            });
        });
        $("#test1").on('click', '.btnDelete', function () {
            $(this).closest('tr').remove();
        });
        function CCno(ccNo) {
            $.ajax({

                type: 'POST',
                url: "/RepairStatus/FindByCcNo?CcNO=" + ccNo,
                contentType: 'application/json; charset=utf-8',
                cache: false,
                success: function (response) {
                    var Quan = 1;
                    var trHTML = '';
                    $.each(response.TableData1, function (i, item) {
                        trHTML +=
                            '<tr  id=databaseValues style="padding-top:5px"><td>' + item.TablespaceCC_NOField1 + '</td><td>' + item.TablespaceJobNumberField1 + '</td><td>' + item.TablespareTypeField1 + '</td><td>' + item.TablespareCodeField1 + '</td><td><img src="" id="foo" alt="" width=100 height=100></td><td id="PartName">' + item.TablespareNameField1 + '</td><td class="editableColumns" id="editableColumns">' + item.TablesparePriceField1 + '</td><td>' + item.TablespareQuantityField1 + '</td><td>' + item.TablespareTotalField1 + '</td><td>' + "<input class=editValues form-control type=button value=Edit style=margin-right:5px;;color:white;background-color:#31b0d5>" + "<input class=saveValues type=button value=Save style=background-color:green;color:white>" + '</td></tr>';
                    });
                    $('#test1').append(trHTML);
                    var DamagedBoxImage = 'http://crm.togofogo.com/UploadedImages/' + response.DamagedBoxImage;
                    var url = 'http://crm.togofogo.com/UploadedImages/' + response.PhotoOfDevice;
                    $('#TRCInfoFull').val("Trc Name:" + response.TrcName + ",Mobile No:" + response.TrcMobile + " , Email:" + response.TrcEmail, " , Address:" + response.TrcAddress +
                        ", Pincode:" + response.TrcPinCode + " ,Location:" + response.TrcLocality + ", Near By Location :" + response.TrcNear_By_Location);
                    $('#CustoFullInfo').val("Name:" + response.Customer_Name + ", Mobile No.:" + response.Mobile_No + ", E-Mail: " + response.Email_Id + ", Customer Address:" + response.Cust_Add +
                        ", Pincode" + response.Pincode + " City/Location:" + response.Cust_City + " , State:" + response.Cust_State);
                    $('#ProcessName').val(response.TrcProcess_Name);
                    $('#TRCCity').val(response.TRCCity);
                    $('#TrcName').val(response.TrcName)
                    $('#WarrentyStatus').val(response.WarrantyStatus);
                    //$('#WarrentyExpiryDate').val(response.WarrantyExpiryDate.split(' ')[0]);
                    $('#EstimatedCost').val(response.EstimatedCost);
                    $('#WarrantyVoid').val(response.WarrantyVoid);
                    $('#wipedevice').val(response.WipeDeviceData);
                    $('#CostApproved').val(response.EstimatedCostApproved);
                    $('#CourierName').val(response.CourierName);
                    $('#ProblemObserved').val(response.PrblmObsrvd);
                    $('#ProblemReported').val(response.Problem)
                    $('#getCC_NO').val(response.CcNo);
                    $('#Mobile_No').val(response.Mobile_No);
                    $('#Brand').val(response.Brand);
                    $('#ServiceProviderName').val(response.ServiceProviderName);
                    $('#Cust_Add').val(response.Cust_Add);
                    $('#Cust_City').val(response.Cust_City);
                    $('#Cust_State').val(response.Cust_State);
                    $('#CustomerId').val(response.CustomerId);

                    $('#Customer_Name').val(response.Customer_Name);
                    $('#Email_Id').val(response.Email_Id);
                    $('#Model').val(response.Model);
                    $('#Pickup_Date').val(response.Pickup_Date);
                    $('#Pincode').val(response.Pincode);
                    $('#Problem').val(response.Problem);
                    $('#StatusName').val(response.StatusName);
                    $('#SubCatName').val(response.SubCatName);
                    $('#Serial_No').val(response.Serial_No);
                    $('#IMEI1').val(response.IMEI1);
                    $('#IMEI2').val(response.IMEI2);
                    $('#BtryRemovable').val(response.BtryRemovable);
                    $('#BtryReq').val(response.BtryReq);
                    $('#IsDiffDeviceRecvd').val(response.IsDiffDeviceRecvd);
                    $('#IsDiffDeviceRecvd').val(response.IsDiffDeviceRecvd);
                    $('#RecvdBrand').val(response.RecvdBrand);
                    $('#RecvdModel').val(response.RecvdModel);
                    $('#IsPhyDamage').val(response.IsPhyDamage);
                    $('#ReceiveDate').val(response.ReceiveDate);
                    $('#RecvRemarks').val(response.RecvRemarks);
                    $('#EnggName').val(response.EnggName);
                    $('#BtryReceived').val(response.BtryReceived);
                    $('#BtryBrandAndModel').val(response.BtryBrandAndModel);
                    $('#DeviceTUPC').val(response.DeviceTUPC);
                    $('#RecvdSerialNo').val(response.RecvdSerialNo);
                    $('#RecvdIMEI1').val(response.RecvdIMEI1);
                    $('#RecvdIMEI2').val(response.RecvdIMEI2);
                    $('#ReceiveApprovalNeeded').val(response.ReceiveApprovalNeeded);
                    $('#RecvApprovalStatus').val(response.RecvApprovalStatus);
                    $('#RecvApprovedBy').val(response.RecvApprovedBy);
                    $('#PhotoOfDevice').attr('src', url);
                    $('#DamagedBoxImage').attr('src', DamagedBoxImage);
                    $('#ReceivedDevice').val(response.RecvdDevice);

                    $('#ApproverRemarks').val(response.ApproverRemarks);
                    $('#IsApproveforReceivingDevice').val(response.IsApproveforReceivingDevice);
                    $('#JobNumber').val(response.JobNumber);
                    $('#CallStatus').val(response.CallStatus);
                    $('#Pfels_Engg_Name').val(response.PfelsEngineerName);
                    $('#WarrantyStickerTempered').val(response.WarrantyStickerTempered);
                    $('#OS_SoftwareReinstall').val(response.OS_SoftwareReinstall);
                    $('#CurrentStatus').val(response.CurrentStatus);
                    $('#DeviceWaterDamaged').val(response.DeviceWaterDamaged);
                    $('#WarrantyVoid').val(response.WarrantyVoid);
                    $('#PfelsProblemFound').val(response.PfelsProblemFound);
                    $('#OS_Software_Reinstall').val(response.OS_Software_Reinstall);
                    $('#Customer_Data_Backup').val(response.Customer_Data_Backup);
                    $('#Current_OS_Software_Name').val(response.Current_OS_Software_Name);
                    $('#Installed_OS').val(response.Installed_OS);
                    $('#DeviceWarrantyVoid').val(response.DeviceWarrantyVoid);
                    $('#JOBDate').val(response.JOBDate);
                    $('#EngineerRemarks').val(response.EngineerRemarks);
                    $('#DeviceServiceCharge').val(response.DeviceServiceCharge);
                    $('#Prcc_Is_Repair_Cost_Approved').val(response.Prcc_Is_Repair_Cost_Approved);
                    $('#Prcc_Callback_Date_and_Time').val(response.Prcc_Callback_Date_and_Time);
                    $('#Prcc_EMail_SMS_Message_To_Customer').val(response.Prcc_EMail_SMS_Message_To_Customer);
                    $('#Prcc_Advance_Payment_Amount').val(response.Prcc_Advance_Payment_Amount);
                    $('#Prcc_Send_Company_Bank_Account_Details').val(response.Prcc_Send_Company_Bank_Account_Details);
                    $('#Prcc_Is_Customer_wants_to_pay_Advance').val(response.Prcc_Is_Customer_wants_to_pay_Advance);
                    $('#Prcc_Customer_Support_Remarks').val(response.Prcc_Customer_Support_Remarks);
                    $('#ApprovedSpareCost').val(response.ApprovedSpareCost);
                    $('#BoxCondition').val(response.BoxCondition);
                    $('#ReceivingDoc').val(response.ReceivingDocument);
                    $('#Returnable').val(response.IsReturnable);
                    $('#NoOfBoxesReceived').val(response.NoOfBoxesReceived);
                },
                error: function (e) {
                    console.log(e);
                    $(".submitbutton").attr("disabled", false);
                    alert("Something went wrong...");

                },
                complete: function () {

                    $(".submitbutton").attr("disabled", false);
                }
            });
        }
        //Calculate button
        function calculateSpareCost() {
            debugger;
            var total = 0;
            var total1 = 0;
            $('#test1 tbody tr[id^="databaseValues"]').each(function (index) {

                var price = parseInt($(this).find("td:eq(8)").text());

                total = total + price;

            });
            $('#ApprovedSpareCost').val(total);
            $('#ApprovedRepairCost').val(total);
            $('#test1 tbody tr[id^="newlyAddedValues"]').each(function (index) {
                debugger;
                var price = parseInt($(this).find("td:eq(8)").text());

                total1 = total1 + price;

            });
            $('#NeedApprovalofSpareCost').val(total1);
            $('#AdditionalSpareCost').val(total1);
            $('#NeedApprovalofRepairCost').val(total1);
            $('#TotalEstimatedSpareCost').val(total + total1);
            $('#TotalEstimatedRepairCost').val(total + total1);
        }
    </script>
}

