@model TogoFogo.Models.ServiceCenter.CallDetailsModel
@{
    ViewBag.Title = "ManageServiceProvidersDetails";
    Layout = "~/Views/Shared/_LayoutPage1.cshtml";
}


@*
    <div class="panel panel-default">

        <div class="panel-heading">

            <div class="row">

                <div class="col-md-12">
                    <ul class="nav nav-tabs nav-tabs-custom m-b-15">
                        <li class="active">
                            <a href="#tab-10" role="tab" data-toggle="tab">
                                <button type="submit" class="btn btn-success m-w-120">Accept Call</button>
                            </a>
                        </li>
                        <li>
                            <a href="#tab-10" role="tab" data-toggle="tab">
                                <button type="submit" class="btn btn-primary m-w-120" id="Tecnicianopen">Accepted Call</button>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
*@

<div class="tab-content">
    <div role="tabpanel" class="tab-pane fade in active" id="tab-10">
        <div class="panel-default m-b-10">
            <div class="panel-heading p-l-0">
                <div class="row">
                    <div class="col-md-12">
                        <h4 class="m-t-0 m-b-5 m-l-20">View Calls</h4>
                        @Html.Partial("_CallInformationForm", Model)
                        @Html.Partial("~/Views/Common/_CustomerInfoForm.cshtml", Model)
                        @Html.Partial("~/Views/Common/_CallLogDeviceInfoForm.cshtml", Model)
                        @Html.Partial("~/Views/Common/_AppointmentDetails.cshtml", Model)
                        @if (Model.Param == "P")
                        {
                            using (Html.BeginForm("ManageServiceProvidersDetails", "ServiceCenter", FormMethod.Post, new { enctype = "multipart/form-data", id = "callform" }))
                            {
                                @Html.HiddenFor(x => x.RejectionReason, new { id = "Rejection_Reason" })
                                @Html.HiddenFor(x => x.StatusId)
                                @Html.HiddenFor(x => x.DeviceId)
                                <div class="row- form-group">
                                    <div class="col-md-3 col-md-offset-9">
                                        <span>
                                            <a href="@Url.Action("AcceptCalls", "ServiceCenter")">
                                                <button type="button" class="btn btn-info m-w-60" id="btnback">Back</button>
                                            </a>
                                            <a href="#">
                                                <button type="button" class="btn btn-danger m-w-60" data-target="#rejectpopup" id="btnReject">Reject</button>
                                            </a>
                                            <a href="#">
                                                <button type="submit" class="btn btn-primary m-w-60" id="btnAccept">Accept</button>
                                            </a>
                                        </span>
                                    </div>
                                </div>

                            }
                        }

                    </div>

                </div>
            </div>
        </div>
    </div>


    @if (Model.Param == "A")
    {
        using (Html.BeginForm("EditAppointment", "ServiceCenter", FormMethod.Post, new { enctype = "multipart/form-data" }))
        {
            @Html.HiddenFor(x => x.DeviceId)     


            <div class="panel-body">
                <div class="form-horizontl">
                    <h4 class="m-t-10 m-b-5 m-b-10 p-b-10">Appointment Detail</h4>
                    <div class="form-group row">

                        <label class="col-sm-2 control-label" for="form-control-1">Appointment Date</label>
                        <div class="col-sm-4">
                            @Html.TextBoxFor(x => x.AppointmentDate, "{0:yyyy-MM-dd}", new { @class = "form-control", @placeholder = "Appointment Date", @type = "date" })
                            @Html.ValidationMessageFor(model => model.AppointmentDate, "", new { @class = "text-danger" })
                        </div>


                        <label class="col-sm-2 control-label" for="form-control-1">Remark</label>
                        <div class="col-sm-4">
                            @Html.TextAreaFor(x => x.Remark, new { @class = "form-control", @placeholder = "Remark" })
                            @Html.ValidationMessageFor(model => model.Remark, "", new { @class = "text-danger" })
                        </div>

                    </div>
                </div>
                </div>


                    }


                    <div class="form-horizontal">
                        <div class="panel-body p-b-0 p-t-0">
                            <div class="panel-heading p-l-0 p-b-0">

                                <div class="row">
                                    <div class="col-md-12">
                                        <h4 class="m-t-0 m-b-5">Assign Call to technician</h4>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    using (Html.BeginForm("SavetechnicianDetails", "ServiceCenter", FormMethod.Post, new { enctype = "multipart/form-data", id = "callform2" }))
                    {

                    @Html.HiddenFor(x => x.Employee.EmpId)
                    @Html.HiddenFor(x => x.DeviceId)

                    <div class="form-group p-l-10" id="DropDown2">
                        <div class="col-sm-3"> <h4>Select Technician</h4></div>
                        <div class="col-sm-5">
                            @*@Html.DropDownListFor(x => x.Employee.EmpId, Model.Employee.EmployeeList, "--Select--", "Text", "Value", new { @class = "form-control", id = "DropDown" })*@

                            @Html.DropDownListFor(m => m.Employee.EmpId, new SelectList(Model.Employee.EmployeeList, "Value", "Text"), "Select", new { @class = "form-control", id = "DropDown" })

                            @Html.ValidationMessageFor(x => x.Employee.EmpId, "", new { @class = "text-danger" })
                        </div>
                    </div>

                    <div class="panel-body">
                        <div id="TechnicianDetailsForm2" style="display:none;">
                            @Html.Partial("_TechnicianDetailsForm", Model.Employee)
                            <div class="form-group m-t-5">
                                <div class="col-md-4 col-md-offset-8">
                                    <button type="button" id="btnemp" class="btn btn-primary pull-right" EmpId="@Model.Employee.EmpId">Submit</button>
                                </div>
                            </div>
                        </div>
                    </div>


                    }
                    }



                </div>







                @*
                    <div role="tabpanel" class="tab-pane fade in" id="tab-12">
                        <div class="panel panel-default panel-table">
                            <div class="panel-body">
                                <div class="panel-default m-b-10">
                                    <div class="panel-heading p-l-0">

                                        <div class="row">

                                            <div class="col-md-12">
                                                <h4 class="m-t-0 m-b-5">Assign Call to technician</h4>
                                                @Html.Partial("_CustomerInfoForm", Model)
                                                </div>

                                                </div>
                                                </div>
                                                </div>
                                                </div>
                                                </div>


                                                <div class="panel panel-default panel-table">
                                                     @Html.Partial("~/view/Common/_CallLogDeviceInfoForm.cshtml", Model)
                                                </div>

                                                <div class="panel panel-default panel-table">
                                                   @Html.Partial("_CallInformationForm", Model)
                                                </div>



                                                <div class="panel panel-default panel-table">
                                                    <div class="panel panel-default panel-table">
                                                        <div class="panel-body">
                                                            <div class="form-horizontal">
                                                                <div class="panel-default m-b-10">
                                                                    <div class="panel-heading p-l-0">
                                                                        <div class="row">
                                                                            <div class="col-md-12">
                                                                                <h4 class="m-t-0 m-b-5">Technician Installation</h4>
                                                                                @Html.Partial("_TechnicianDetailsForm", Model)
                                                                            </div>

                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                </div>
                *@




                <div id="rejectpopup" class="modal fade" role="dialog">
                    <div class="modal-dialog">
                        <!-- Modal content-->
                        <div class="modal-content">
                            <div class="modal-body">
                                <div class="form-group col-md-12" id="rejectResonDiv">
                                    <label for="form-control-3" class="col-sm-3 col-md-3 control-label">Rejected Reason</label>
                                    <div class="col-sm-8 col-md-8">

                                        @Html.TextAreaFor(model => model.RejectionReason, new { @class = "form-control", id = "Reasontxt" })
                                        @Html.ValidationMessageFor(model => model.RejectionReason, "", new { @class = "text-danger" })
                                    </div>
                                </div>

                            </div>
                            <div class="modal-footer">
                                <button type="button" id="btnrejectreasion" class="btn btn-primary" deviceID="@Model.DeviceId">Submit</button>
                                <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
                            </div>
                        </div>

                    </div>
                </div>
                @section scripts{
                    @Scripts.Render("~/bundles/jqueryval")
                    @Scripts.Render("~/bundles/js/form-m")
                    <script>

      $(document).ready(function () {

         $("#btnReject").click(function () {

                    $("#rejectpopup").modal("show");

         });
        $("#btnrejectreasion").click(function () {
                //var statusId = $("#CallDetails_StatusId").val();
                debugger
                //var status_Id = $(this).attr(st);
                //document.getElementById().val = status_Id;

                var rejectionreason = $("#Reasontxt").val();
                $("#Rejection_Reason").val(rejectionreason);
                $("#StatusId").val(9);
                $("#callform").submit();

        });

          $("#btnemp").click(function () {
              $("#callform2").submit();
          });
      $("#DropDown").change(function () {

          var Id = $(this).val();
         // var Id = $dd.val();
          $.ajax({
              type: "POST",
              url: "/ServiceCenter/TechnicianDetails",
              data: {
                  EmpId: Id
              },
              success: function (response) {
                  console.log(response);
                  console.log(response.EMPPhotoUrl);
                  $("#EmpId").val(response.EmpId);
                  $("#TechnicianTypeName").val(response.TechnicianTypeName);
                  $("#TechnicianName").val(response.TechnicianName);
                  $("#ContactNumber").val(response.ConMobileNumber);
                  if (response.EMPPhoto != null || response.EMPPhoto != "") {
                      $("#EmpImg").prop("src", response.EMPPhotoUrl);
                  }
                  $("#TotalOpenCalls").val(response.TotalOpenCalls);
                  $("#TotalCloseCalls").val(response.TotalCloseCalls);
                  $("#Vehicle_VehicleTypeName").val(response.Vehicle.VehicleTypeName);
                  $("#Vehicle_VehicleBrand").val(response.Vehicle.VehicleBrand);
                  $("#Vehicle_VHModel").val(response.Vehicle.VHModel);
                  $("#Vehicle_VHNumber").val(response.Vehicle.VHNumber);
                  $("#Vehicle_DrivingLicense").val(response.Vehicle.DrivingLicense);

                  if (response.Vehicle.InsuranceExpairyDate !=null)
                  $("#Vehicle_InsuranceExpairyDate").val(new Date(parseInt(response.Vehicle.InsuranceExpairyDate.substr(6))));
                  console.log(response);
              },
              error: function (e) {
                  console.log(e);
                  alert("Something went wrong...");
              },
              complete: function () {
                  $("#TechnicianDetailsForm2").show();
                  $("#DropDown2").hide();
              }
          })

      });
      });
        $(document).ready(function () {

            $("#IsExistingCustomer").attr('disabled', true);
            $("#CustomerContactNumber").attr('disabled', true);
            $("#CustomerTypeId").attr('disabled', true);
            $("#CustomerName").attr('disabled', true);
            $("#CustomerEmail").attr('disabled', true);
            $("#Address").attr('disabled', true);
            $("#NearLocation").attr('disabled', true);
            $("#PinNumber").attr('disabled', true);
            $("#CountryId").attr('disabled', true);
            $("#StateId").attr('disabled', true);
            $("#CityId").attr('disabled', true);
            $("#DeviceCategoryId").attr('disabled', true);
            $("#DeviceSubCategoryId").attr('disabled', true);
            $("#DeviceBrandId").attr('disabled', true);
            $("#DeviceModelNo").attr('disabled', true);
            $("#DeviceModalId").attr('disabled', true);
            $("#BillNo").attr('disabled', true);
            $("#DeviceIMEIOne").attr('disabled', true);
            $("#DeviceIMEISecond").attr('disabled', true);
            $("#PurchaseFrom").attr('disabled', true);
            $("#DOP").attr('disabled', true);
            $("#BillAmount").attr('disabled', true);
            $("#DeviceConditionId").attr('disabled', true);
            $("input:radio").prop('disabled', true);

        });

                    </script>
                }
